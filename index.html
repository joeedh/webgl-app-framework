<!DOCTYPE html>
<html>
<head><title>Test</title>
  <meta http-equiv="cache-control" content="max-age=0" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
  <meta http-equiv="pragma" content="no-cache" />

<script type="shader" id="simpleshader">
//VERTEX
precision highp float;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform mat4 objectMatrix;
uniform mat4 normalMatrix;
uniform float iGlobalTime;
uniform vec4 uColor;

attribute vec3  position;
attribute vec3  normal;
attribute vec2  uv;
attribute vec4  color;
attribute float id;

varying vec3 v_Normal;
varying vec2 v_Uv;
varying vec4 v_Color;
varying float v_Id;

void main(void) {
  vec4 p = vec4(position, 1.0);
  
  bool bad = dot(objectMatrix[0], objectMatrix[0]) == 0.0;
  bad = bad && dot(objectMatrix[1], objectMatrix[1]) == 0.0;
  bad = bad && dot(objectMatrix[2], objectMatrix[2]) == 0.0;
  if (!bad) {
    p = objectMatrix * p;
  }
  
  p = projectionMatrix * p;
  
  gl_Position = p;
  
  v_Normal = (normalMatrix * vec4(normal, 0.0)).xyz;
  v_Uv = uv;
  v_Id = id;
  v_Color = uColor;
  //v_Color = color;
}

//FRAGMENT
precision highp float;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform mat4 normalMatrix;
uniform vec4 uColor;
uniform float iGlobalTime;

varying vec3 v_Normal;
varying vec2 v_Uv;
varying vec4 v_Color;
varying float v_Id;

float tent(float f) {
  return 1.0 - abs(fract(f)-0.5)*2.0;
}

vec3 tent(vec3 p) {
  return vec3(
    tent(p[0]),
    tent(p[1]),
    tent(p[2])
  );
}

void main(void) {
  float c = 1.0; //fract(v_Uv[0]*10.0);
  vec3 l = normalize(vec3(0.2, 0.2, 0.8));
  vec3 n = normalize(v_Normal);
  
  //c = max(dot(n, l), 0.0);
  c = abs(dot(n, l));
  
  //float f = 1.0-tent(10.0*v_Uv[0])*tent(10.0*v_Uv[1]);
  //f = pow(f, 10.0)*0.3+0.7;
  float f = sin(iGlobalTime*1.0)*0.5 + 0.5;
  
  gl_FragColor = uColor * vec4(c, c, c, 1.0);
}
</script>
  
  <style>
    body, html {
      margin: 0px;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #canvas2d {
      width: 100%;
      height: 100%;
      position: absolute;
      z-index: -3;
      background-color: rgba(255, 255, 255, 0);
      opacity: 1.0;
    }
    
    #canvas3d {
      width: 100%;
      height: 100%;
      position: absolute;
      z-index: -2;
      background-color: rgba(255, 255, 255, 0);
      opacity: 1.0;
    }
  </style>
  <script type="module" src="scripts/entry_point.js"></script>
</head>
<body onload="init()">
<img id="iconsheet16" style="display:none" src="assets/iconsheet16.png"></img>
<img id="iconsheet24" style="display:none" src="assets/iconsheet24.png"></img>
<img id="iconsheet32" style="display:none" src="assets/iconsheet32.png"></img>
<img id="iconsheet40" style="display:none" src="assets/iconsheet40.png"></img>
<img id="iconsheet50" style="display:none" src="assets/iconsheet50.png"></img>
<img id="iconsheet64" style="display:none" src="assets/iconsheet64.png"></img>
<img id="iconsheet80" style="display:none" src="assets/iconsheet80.png"></img>
<img id="iconsheet128" style="display:none" src="assets/iconsheet128.png"></img>
<div id="content">
  <canvas id="canvas2d">
  </canvas>
  <canvas id="canvas3d">
  </canvas>
</div>
</body>
</html>
  